name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do c칩digo
        uses: actions/checkout@v3

      - name: Configurar ambiente
        run: echo "Configurando ambiente para lint..."

      - name: Executar lint (verifica칞칚o de formata칞칚o)
        run: echo "Executando lint no c칩digo..."

  build:
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: Checkout do c칩digo
        uses: actions/checkout@v3

      - name: Configurar ambiente de build
        run: echo "Configurando ambiente de build..."

      - name: Compilar c칩digo
        run: echo "Compilando o c칩digo..."

  test:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Checkout do c칩digo
        uses: actions/checkout@v3

      - name: Instalar depend칡ncias
        run: echo "Instalando depend칡ncias..."

      - name: Executar testes unit치rios
        run: echo "Rodando testes unit치rios..."

      - name: Executar testes de integra칞칚o
        run: echo "Rodando testes de integra칞칚o..."

  security-check:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: Checkout do c칩digo
        uses: actions/checkout@v3

      - name: Verificar vulnerabilidades de seguran칞a
        run: echo "Verificando vulnerabilidades de seguran칞a..."

  deploy-staging:
    runs-on: ubuntu-latest
    needs: security-check
    steps:
      - name: Checkout do c칩digo
        uses: actions/checkout@v3

      - name: Configurar ambiente de staging
        run: echo "Configurando ambiente de staging..."

      - name: Implantar em staging
        run: echo "Implantando aplica칞칚o em staging..."

  deploy-production:
    runs-on: ubuntu-latest
    needs: deploy-staging
    if: github.ref == 'refs/heads/main'  # S칩 executa na branch main
    steps:
      - name: Checkout do c칩digo
        uses: actions/checkout@v3

      - name: Configurar ambiente de produ칞칚o
        run: echo "Configurando ambiente de produ칞칚o..."

      - name: Aprova칞칚o manual para deploy em produ칞칚o
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: "游녦 O deploy para produ칞칚o est치 pronto! Por favor, aprove a execu칞칚o."
            })
            core.setFailed("Aguardando aprova칞칚o manual para deploy em produ칞칚o...")

      - name: Implantar em produ칞칚o
        run: echo "Implantando aplica칞칚o em produ칞칚o..."
